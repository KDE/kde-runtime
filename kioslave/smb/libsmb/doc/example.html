<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
	<TITLE>Simple example for the smb library</TITLE>
	<META NAME="GENERATOR" CONTENT="StarOffice/5.0 (Unix)">
	<META NAME="CREATED" CONTENT="19990525;16575300">
	<META NAME="CHANGEDBY" CONTENT="Brodu Nicolas">
	<META NAME="CHANGED" CONTENT="19990525;17025400">
	<STYLE>
	<!--
		TD P { color: #000000 }
		P { color: #000000 }
		A:link { color: #0000ee }
		A:visited { color: #000088 }
	-->
	</STYLE>
</HEAD>
<BODY TEXT="#000000" LINK="#0000ee" VLINK="#000088" BGCOLOR="#ffffff">
<P ALIGN=LEFT><FONT COLOR="#008000">#include</FONT>
<FONT COLOR="#b3b300">&lt;iostream.h&gt;</FONT><BR><FONT COLOR="#008000">#include</FONT>
<FONT COLOR="#b3b300">&lt;stdio.h&gt;</FONT><BR><FONT COLOR="#008000">#include</FONT>
<FONT COLOR="#b3b300">&lt;sys/types.h&gt;</FONT><BR><FONT COLOR="#008000">#include</FONT>
<FONT COLOR="#b3b300">&lt;sys/stat.h&gt;</FONT><BR><FONT COLOR="#008000">#include</FONT>
<FONT COLOR="#b3b300">&lt;fcntl.h&gt;</FONT><BR><FONT COLOR="#008000">#include</FONT>
<FONT COLOR="#b3b300">&lt;unistd.h&gt;</FONT><BR><FONT COLOR="#008000">#include</FONT>
<FONT COLOR="#b3b300">&lt;smb.h&gt;</FONT><BR><BR><BR><FONT COLOR="#999999">/*<BR>&nbsp;This
function will be a mean for SMBIO to retrieve data<BR>&nbsp;used when
passwords are needed for example<BR>&nbsp;it should display &quot;message&quot;
and return the user answer<BR>&nbsp;If you don't provide one, null
passwords will always be used,<BR>&nbsp;If you do provide one, null
passwords will be tested as well<BR>*/<BR></FONT><FONT COLOR="#198a8a">char</FONT>*getFunc(<FONT COLOR="#198a8a">const
char</FONT>*message)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;cout&lt;&lt;message&lt;&lt;<FONT COLOR="#996633">&quot;\n&quot;</FONT>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#198a8a">char</FONT>*tmp=getpass(<FONT COLOR="#996633">&quot;&quot;</FONT>);<BR>&nbsp;&nbsp;&nbsp;&nbsp;cout&lt;&lt;<FONT COLOR="#996633">&quot;\n&quot;</FONT>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#198a8a">char</FONT>*
ret=new char[strlen(tmp)+<FONT COLOR="#0000ff">1</FONT>];<BR>&nbsp;&nbsp;&nbsp;&nbsp;strcpy(ret,tmp);<BR>&nbsp;&nbsp;&nbsp;&nbsp;return
ret;<BR>}</P>
<P><BR><BR>
</P>
<P>main(<FONT COLOR="#198a8a">int </FONT>argc,<FONT COLOR="#198a8a">
char </FONT>**argv)<BR>{<BR><BR><FONT COLOR="#999999">// Simple name
resolver commented out<BR><BR>/*<BR>&nbsp;&nbsp;&nbsp;&nbsp;NMBIO
nio;<BR>&nbsp;&nbsp;&nbsp;&nbsp;// Will do a NMB lookup of the first
argument<BR>&nbsp;&nbsp;&nbsp;&nbsp;NBHostEnt
*list=nio.gethostbyname(argc&gt;1?argv[1]:&quot;cthulhu&quot;);<BR>&nbsp;&nbsp;&nbsp;&nbsp;if
(!list) cout&lt;&lt;&quot;Null list !\n&quot;;<BR>&nbsp;&nbsp;&nbsp;&nbsp;else<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//
Print corresponding IP<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NBHostEnt
*sav=list;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while
(list)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
printf(&quot;%d.%d.%d.%d\n&quot;,(list-&gt;ip&gt;&gt;24)&amp;0xFF,(list-&gt;ip&gt;&gt;16)&amp;0xFF,(list-&gt;ip&gt;&gt;8)&amp;0xFF,list-&gt;ip&amp;0xFF);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list=list-&gt;next;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete
sav;<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;return
0;<BR>*/<BR></FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;SMBIO io(getFunc);<BR><FONT COLOR="#999999">//
io.setDefaultBrowseServer(&quot;cthulhu&quot;);<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;io.setDefaultUser(&quot;brodu&quot;);<BR><BR><FONT COLOR="#999999">&nbsp;&nbsp;&nbsp;&nbsp;//
process command-line argument as a URL<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#ff00ff">if</FONT>
(argc&gt;=<FONT COLOR="#0000ff">2</FONT>) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#198a8a">struct</FONT>
stat statbuf;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#ff00ff">if</FONT>
(io.stat(argv[<FONT COLOR="#0000ff">1</FONT>],&amp;statbuf)==<FONT COLOR="#0000ff">-1</FONT>)
{cout&lt;&lt;<FONT COLOR="#996633">&quot;error stat\n&quot;</FONT>;
<FONT COLOR="#ff00ff">return</FONT> <FONT COLOR="#0000ff">0</FONT>;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<FONT COLOR="#996633">&quot;=&gt;
mode=%o,
size=%lu\n&quot;</FONT>,statbuf.st_mode,statbuf.st_size);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR><FONT COLOR="#999999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//
Test mode : directory =&gt; list<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#ff00ff">if</FONT>
(statbuf.st_mode&amp;<FONT COLOR="#0000ff">040000</FONT>)
{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#198a8a">int</FONT>
dd=io.opendir(argv[<FONT COLOR="#0000ff">1</FONT>]);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#ff00ff">if</FONT>
(dd==<FONT COLOR="#0000ff">-1</FONT>) {cout&lt;&lt;<FONT COLOR="#996633">&quot;error,
dd=-1\n&quot;</FONT>; <FONT COLOR="#ff00ff">return</FONT>
<FONT COLOR="#0000ff">0</FONT>;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SMBdirent
*dent;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#ff00ff">while</FONT>
((dent=io.readdir(dd))) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<FONT COLOR="#996633">&quot;=&gt;
mode=%o, size=%u,
name=%s\n&quot;</FONT>,dent-&gt;st_mode,dent-&gt;st_size,dent-&gt;d_name);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.closedir(dd);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#ff00ff">return</FONT>
<FONT COLOR="#0000ff">0</FONT>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR><FONT COLOR="#999999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//
And file =&gt; download<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#ff00ff">else</FONT>
{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#198a8a">int</FONT>
fd;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#ff00ff">if</FONT>
((fd=io.open(argv[1],O_RDONLY))==<FONT COLOR="#0000ff">-1</FONT>)
{cout&lt;&lt;<FONT COLOR="#996633">&quot;error open\n&quot;</FONT>;
<FONT COLOR="#ff00ff">return</FONT> <FONT COLOR="#0000ff">-1</FONT>;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#198a8a">char</FONT>
*name=io.getName(fd);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#198a8a">int</FONT><FONT COLOR="#ff0000">
</FONT>locfd=open(name, O_WRONLY | O_CREAT, <FONT COLOR="#0000ff">0644</FONT>);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#ff00ff">delete</FONT>
name;<BR><FONT COLOR="#999999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*
You can use any buffer size */<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#198a8a">int</FONT>
count, total=<FONT COLOR="#0000ff">0</FONT>,
size=<FONT COLOR="#0000ff">123456</FONT>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#198a8a">char</FONT>
*buffer=<FONT COLOR="#ff00ff">new</FONT> <FONT COLOR="#198a8a">char</FONT>[size];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#ff00ff">do</FONT>
{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count=io.read(fd,
buffer, size);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#ff00ff">if</FONT>
(count==<FONT COLOR="#0000ff">-1</FONT>) {cout&lt;&lt;<FONT COLOR="#996633">&quot;io.read
error\n&quot;</FONT>;
<FONT COLOR="#ff00ff">break</FONT>;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write(locfd,buffer,count);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total+=count;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
<FONT COLOR="#ff00ff">while</FONT>
(count&gt;<FONT COLOR="#0000ff">0</FONT>);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&lt;&lt;total&lt;&lt;<FONT COLOR="#996633">&quot;
byte read.\n&quot;</FONT>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#ff00ff">delete</FONT>
buffer;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(locfd);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.close(fd);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT COLOR="#ff00ff">return</FONT>
<FONT COLOR="#0000ff">0</FONT>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;}
<FONT COLOR="#999999">// endif argc&gt;=2</FONT><BR><BR>}<BR><BR><BR>
</P>
</BODY>
</HTML>