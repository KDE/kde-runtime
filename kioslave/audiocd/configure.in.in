AC_MSG_CHECKING(for cdparanoia libraries and headers)

AC_ARG_WITH(cdparanoia,
  [  --with-cdparanoia[=DIR] Compile in cdparanoia support. [default=check]],
  [
    case "$withval" in
    yes)
      with_cdparanoia=CHECK
      ;;
    esac
  ],
  [
    with_cdparanoia=CHECK
  ]
)dnl

if test "x$with_cdparanoia" = "xCHECK" ; then
  with_cdparanoia=NOTFOUND
  search_incs="$kde_includes /usr/include /usr/local/include"
  AC_FIND_FILE(cdda_interface.h, $search_incs, para_incdir)
  if test -r $para_incdir/cdda_interface.h ; then
    test "x$para_incdir" != "x/usr/include" && CDPARANOIA_INCS="-I$para_incdir"
    with_cdparanoia=FOUND
  fi
  if test $with_cdparanoia = FOUND ; then
    with_cdparanoia=NOTFOUND
    for ext in la so sl a ; do
      AC_FIND_FILE(libcdda_paranoia.$ext, $kde_libraries /usr/lib /usr/local/lib,
        para_libdir)
      if test -r $para_libdir/libcdda_paranoia.$ext ; then
        if test "x$para_libdir" != "x/usr/lib" ; then
          CDPARANOIA_LIBS="-L$para_libdir "
	  test "$WITH_RPATH" = yes && CDPARANOIA_RPATH="-R $para_libdir"
        fi
        CDPARANOIA_LIBS="${CDPARANOIA_LIBS}-lcdda_paranoia -lcdda_interface"
	with_cdparanoia=FOUND
        break
      fi
    done
  fi
fi

case "$with_cdparanoia" in
no) AC_MSG_RESULT(no) ;;
NOTFOUND) AC_MSG_RESULT(searched but not found) ;;
*)
  if test "x$with_cdparanoia" = "xFOUND" ; then
    AC_MSG_RESULT(found (incs=$para_incdir libs=$para_libdir))
  else
    AC_MSG_RESULT($with_cdparanoia)
    CDPARANOIA_ROOT="$with_cdparanoia"
    if test "x$CDPARANOIA_ROOT" != "x/usr" ; then
      CDPARANOIA_INCS="-I${CDPARANOIA_ROOT}/include"
      CDPARANOIA_LIBS="-L${CDPARANOIA_ROOT}/lib "
      if test "$WITH_RPATH" = "yes" ; then
        CDPARANOIA_RPATH="-R ${CDPARANOIA_ROOT}/lib"
      fi
    fi
    CDPARANOIA_LIBS="${CDPARANOIA_LIBS}-lcdda_paranoia -lcdda_interface"
  fi
  AC_DEFINE_UNQUOTED(HAVE_CDPARANOIA, 1, [Define if you have cdparanoia])
  AUDIOCD_SUBDIR="audiocd"
  ;;
esac

AC_SUBST(CDPARANOIA_INCS)
AC_SUBST(CDPARANOIA_LIBS)
AC_SUBST(CDPARANOIA_RPATH)
AC_SUBST(AUDIOCD_SUBDIR)

